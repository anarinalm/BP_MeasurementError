<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Measurement Error - 5&nbsp; Model Diagnostics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./add_noise.html" rel="next">
<link href="./initial_modeling.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./diagnostics.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Model Diagnostics</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Measurement Error</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Preparing the NHANES Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./initial_modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modeling Diabetes Occurrence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diagnostics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Model Diagnostics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./add_noise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Creating “Noisy” Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#likelihood-ratio-test" id="toc-likelihood-ratio-test" class="nav-link active" data-scroll-target="#likelihood-ratio-test"><span class="header-section-number">5.1</span> Likelihood Ratio Test</a></li>
  <li><a href="#model-fit" id="toc-model-fit" class="nav-link" data-scroll-target="#model-fit"><span class="header-section-number">5.2</span> Model Fit</a></li>
  <li><a href="#calibration-plot" id="toc-calibration-plot" class="nav-link" data-scroll-target="#calibration-plot"><span class="header-section-number">5.3</span> Calibration Plot</a></li>
  <li><a href="#hosmer-lemeshow-test" id="toc-hosmer-lemeshow-test" class="nav-link" data-scroll-target="#hosmer-lemeshow-test"><span class="header-section-number">5.4</span> Hosmer-Lemeshow Test</a></li>
  <li><a href="#roc-curve" id="toc-roc-curve" class="nav-link" data-scroll-target="#roc-curve"><span class="header-section-number">5.5</span> ROC Curve</a></li>
  <li><a href="#residuals-histogram" id="toc-residuals-histogram" class="nav-link" data-scroll-target="#residuals-histogram"><span class="header-section-number">5.6</span> Residuals Histogram</a></li>
  <li><a href="#ignore" id="toc-ignore" class="nav-link" data-scroll-target="#ignore"><span class="header-section-number">5.7</span> Ignore///</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Model Diagnostics</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmtoolbox)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(predtools)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#using data specified in this github repository:</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">"jhs-hwg/cardioStatsUSA"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cardioStatsUSA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#to prevent errors, exclude the rows with na:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>used_vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'cc_diabetes'</span>, <span class="st">'bp_sys_mean'</span>, <span class="st">'demo_age_years'</span>, <span class="st">'demo_race'</span>, <span class="st">'demo_gender'</span>, <span class="st">'cc_bmi'</span>, <span class="st">'cc_smoke'</span>, <span class="st">'bp_med_use'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>clean_nhanes <span class="ot">&lt;-</span> nhanes_data[<span class="fu">complete.cases</span>(nhanes_data[,..used_vars]), ]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(cc_diabetes <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> clean_nhanes, <span class="at">family=</span>binomial)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>simple_diab_model_sys <span class="ot">&lt;-</span> <span class="fu">glm</span>(cc_diabetes <span class="sc">~</span> bp_sys_mean, <span class="at">data =</span> clean_nhanes, <span class="at">family =</span> binomial)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>full_diab_model_sys <span class="ot">&lt;-</span> <span class="fu">glm</span>(cc_diabetes <span class="sc">~</span> bp_sys_mean <span class="sc">+</span> demo_age_years <span class="sc">+</span> demo_race <span class="sc">+</span> demo_gender<span class="sc">+</span> cc_bmi <span class="sc">+</span> cc_smoke <span class="sc">+</span> bp_med_use, <span class="at">data =</span> clean_nhanes, <span class="at">family =</span> binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next step will be to evaluate the model to determine ______.</p>
<section id="likelihood-ratio-test" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="likelihood-ratio-test"><span class="header-section-number">5.1</span> Likelihood Ratio Test</h2>
<p>The likelihood ratio test involves comparing whether two models are significantly different. Here, we will compare our full model with the null model (no covariates):</p>
<p>The null hypothesis is that there is no significant difference between the null model <span class="math inline">\(H_0\)</span> and the full model <span class="math inline">\(H_1\)</span>.</p>
<p>The test compares the predicted likelihood of an observed outcome under the null model vs the predicted likelihood of the outcome under the model. In this case, the outcome will be diabetes. The test statistic will be calculated <span class="math inline">\(\lambda = -2 log(\frac{L(H_0)}{L(H_1)})\)</span>, where L denotes the likelihood of diabetes evaluated under each model. If the likelihood is much higher in the full model than in the null model, it means that additional parameters improve the model fit. As a result, <span class="math inline">\(\lambda\)</span> and its corresponding p value will be a much smaller, providing stronger evidence that we may need to reject the null hypothesis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(full_diab_model_sys, null_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">#Df</th>
<th style="text-align: right;">LogLik</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Chisq</th>
<th style="text-align: right;">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: right;">-16527.27</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">-20638.95</td>
<td style="text-align: right;">-13</td>
<td style="text-align: right;">8223.36</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>As expected, we can see that the full model is significant compared to the null hypothesis. We can also compare it to the simple model which uses only systolic blood pressure as a variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(full_diab_model_sys, simple_diab_model_sys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">#Df</th>
<th style="text-align: right;">LogLik</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Chisq</th>
<th style="text-align: right;">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: right;">-16527.27</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-19943.85</td>
<td style="text-align: right;">-12</td>
<td style="text-align: right;">6833.152</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="model-fit" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="model-fit"><span class="header-section-number">5.2</span> Model Fit</h2>
<p>Let’s evaluate the accuracy of our model: We first calculate the predicted probabilities using a cutoff probability of 0.5 with our model. Then, we compare these predictions to the references and find our accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pred_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_diab_model_sys, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pred_ys <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_probs <span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>clean_nhanes<span class="sc">$</span>cc_diabetes_num <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(clean_nhanes<span class="sc">$</span>cc_diabetes <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clean_nhanes<span class="sc">$</span>cc_diabetes_num, pred_ys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   pred_ys
        0     1
  0 44302   859
  1  6167   869</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(pred_ys),<span class="fu">as.factor</span>(clean_nhanes<span class="sc">$</span>cc_diabetes_num), <span class="at">positive =</span> <span class="st">'1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 44302  6167
         1   859   869
                                          
               Accuracy : 0.8654          
                 95% CI : (0.8624, 0.8683)
    No Information Rate : 0.8652          
    P-Value [Acc &gt; NIR] : 0.4522          
                                          
                  Kappa : 0.1533          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.12351         
            Specificity : 0.98098         
         Pos Pred Value : 0.50289         
         Neg Pred Value : 0.87781         
             Prevalence : 0.13480         
         Detection Rate : 0.01665         
   Detection Prevalence : 0.03311         
      Balanced Accuracy : 0.55224         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pred_probs_simple <span class="ot">&lt;-</span> <span class="fu">predict</span>(simple_diab_model_sys, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pred_ys <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_probs <span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>clean_nhanes<span class="sc">$</span>cc_diabetes_num <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(clean_nhanes<span class="sc">$</span>cc_diabetes <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clean_nhanes<span class="sc">$</span>cc_diabetes_num, pred_ys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   pred_ys
        0     1
  0 44302   859
  1  6167   869</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(pred_ys),<span class="fu">as.factor</span>(clean_nhanes<span class="sc">$</span>cc_diabetes_num), <span class="at">positive =</span> <span class="st">'1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 44302  6167
         1   859   869
                                          
               Accuracy : 0.8654          
                 95% CI : (0.8624, 0.8683)
    No Information Rate : 0.8652          
    P-Value [Acc &gt; NIR] : 0.4522          
                                          
                  Kappa : 0.1533          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.12351         
            Specificity : 0.98098         
         Pos Pred Value : 0.50289         
         Neg Pred Value : 0.87781         
             Prevalence : 0.13480         
         Detection Rate : 0.01665         
   Detection Prevalence : 0.03311         
      Balanced Accuracy : 0.55224         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Our model has a final accuracy of about 86%, and mostly misclassifies those with diabetes as without (false negatives).</p>
</section>
<section id="calibration-plot" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="calibration-plot"><span class="header-section-number">5.3</span> Calibration Plot</h2>
<p>The calibration plot compares predicted probabilities to observed probabilities. Essentially, it will compare the data points for which the model predicted probabilities in a certain range and the true observed proportion of these data points which were predicted positives. Ideally, a model will fit close to the line x=y: this would imply that the model’s predictions align with the actual outcome. For example, if our model assigns 100 data points a predicted probability value between 0 and 0.1, and 10 of those points is a positive, then our model fits the data quite well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>clean_nhanes<span class="sc">$</span>pred <span class="ot">&lt;-</span> pred_probs</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">calibration_plot</span>(<span class="at">data =</span> clean_nhanes, <span class="at">obs =</span> <span class="st">"cc_diabetes_num"</span>, <span class="at">pred =</span> <span class="st">"pred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$calibration_plot</code></pre>
</div>
<div class="cell-output-display">
<<<<<<< HEAD
<div>
<figure class="figure">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
=======
<p><img src="diagnostics_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>clean_nhanes<span class="sc">$</span>pred_simple <span class="ot">&lt;-</span> pred_probs_simple</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">calibration_plot</span>(<span class="at">data =</span> clean_nhanes, <span class="at">obs =</span> <span class="st">"cc_diabetes_num"</span>, <span class="at">pred =</span> <span class="st">"pred_simple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$calibration_plot</code></pre>
</div>
<div class="cell-output-display">
<<<<<<< HEAD
<div>
<figure class="figure">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
=======
<p><img src="diagnostics_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
<p><strong>Brier Test</strong></p>
<p>The Brier Score is a value which measures the accuracy of the model to the data. In this case, it is equal to mean-squared error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((clean_nhanes<span class="sc">$</span>cc_diabetes_num <span class="sc">-</span> pred_probs)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09791126</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((clean_nhanes<span class="sc">$</span>cc_diabetes_num <span class="sc">-</span> pred_probs_simple)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1137431</code></pre>
</div>
</div>
</section>
<section id="hosmer-lemeshow-test" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="hosmer-lemeshow-test"><span class="header-section-number">5.4</span> Hosmer-Lemeshow Test</h2>
<p>The Homser-Lemeshow test divides the data into 10 different subgroups of equal size, each with increasing risk for positive prediction, or diabetes in our case. The observed number of those with diabetes in the each group is compared with the expected number based on the model’s prediction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hltest</span>(full_diab_model_sys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   The Hosmer-Lemeshow goodness-of-fit test

 Group Size Observed   Expected
     1 5220       29   47.93194
     2 5220       44   96.09769
     3 5220       99  156.96748
     4 5220      183  236.32193
     5 5220      347  341.67554
     6 5220      529  485.18466
     7 5220      848  696.01150
     8 5220     1112 1009.00717
     9 5220     1554 1507.32695
    10 5217     2291 2459.47515

         Statistic =  150.6378 
degrees of freedom =  8 
           p-value =  &lt; 2.22e-16 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hltest</span>(simple_diab_model_sys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   The Hosmer-Lemeshow goodness-of-fit test

 Group Size Observed    Expected
     1 5310      320  392.900614
     2 5205      336  455.497648
     3 4905      382  472.429670
     4 5211      470  544.366735
     5 5159      547  583.643016
     6 5283      707  652.225758
     7 5229      818  710.886418
     8 5410     1057  830.456544
     9 5260     1129  962.117074
    10 5220     1269 1427.789578
    11    5        1    3.686982

         Statistic =  246.1812 
degrees of freedom =  9 
           p-value =  &lt; 2.22e-16 </code></pre>
</div>
</div>
<p>In our model, we can see that the expected values are somewhat higher than the observed values in the lower proportion groups, however the fit seems to generally be accurate.</p>
</section>
<section id="roc-curve" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="roc-curve"><span class="header-section-number">5.5</span> ROC Curve</h2>
<p>The Receiver Operating Curve shows the performance of a model by plotting sensitivity vs specificity at different threshold values.</p>
<p>Sensitivity (AKA True Positive Rate) measures the proportion of true positives (samples correctly predicted as diabetes positive) to all the observed positives in the data. This can be written as <span class="math display">\[\text{Sensitivity} = \frac{\text{True Positives}}{\text{True Positives + False Negatives}}\]</span></p>
<p>Specificity (AKA True Negative Rate) measures the proportion of true negatives (samples correctly predicted as diabetes negative) to all the observed negatives in the data. This can be written as <span class="math display">\[\text{Specificity} = \frac{\text{True Negativites}}{\text{True Negativites + False Positives}}\]</span></p>
<p>As a model’s sensitivity increases, specificity will tend to decrease.</p>
<p>At different threshold values (for example, we typically use 0.5 for prediction, but could use any value from 0 to 1), we can calculate both sensitivity and specificity and plot these values on a curve.</p>
<p>The baseline curve used for comparison is just the line y=x. This is essentially modeling random prediction. The closer the curve is to the left and top edge, the better its performance, since it shows a high sensitivity without a huge drop off in specificity.</p>
<p>The AUC, or area under the curve, provides a single number to quantify this curve. The higher the performance of a model, the closer the ROC to the top left and the bigger the area under the curve. The ideal AUC, with both measurements always at 1 due to perfect predictions, would be 1. In practice, AUCs are typically in the range of 80-90.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>roc_mod <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">predictor=</span>pred_probs, <span class="at">response=</span>clean_nhanes<span class="sc">$</span>cc_diabetes_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_mod, <span class="at">print.auc =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<<<<<<< HEAD
=======
<div class="cell-output-display">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>roc_mod <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">predictor=</span>pred_probs_simple, <span class="at">response=</span>clean_nhanes<span class="sc">$</span>cc_diabetes_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_mod, <span class="at">print.auc =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="residuals-histogram" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="residuals-histogram"><span class="header-section-number">5.6</span> Residuals Histogram</h2>
<p>A histogram of residuals should resemble a standard normal distribution, ideally. The histogram will plot the frequency of each pearson residual value. In an ideal model, the error between the predictions and observations (residuals) will be a result of random noise, creating a Gaussian shape. Skewness and irregularities may be a sign that the model is not fit properly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(full_diab_model_sys, <span class="at">type=</span><span class="st">"pearson"</span>), <span class="at">breaks =</span> <span class="dv">20</span>) <span class="co">#specify shape</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
<div class="cell-output-display">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>lev <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(full_diab_model_sys)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>top_10 <span class="ot">&lt;-</span> <span class="fu">sort</span>(lev, <span class="at">decreasing=</span><span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>clean_nhanes[<span class="fu">as.numeric</span>(<span class="fu">names</span>(top_10))] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(used_vars)) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">cc_diabetes</th>
<th style="text-align: right;">bp_sys_mean</th>
<th style="text-align: right;">demo_age_years</th>
<th style="text-align: left;">demo_race</th>
<th style="text-align: left;">demo_gender</th>
<th style="text-align: left;">cc_bmi</th>
<th style="text-align: left;">cc_smoke</th>
<th style="text-align: left;">bp_med_use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">217.3333</td>
<td style="text-align: right;">51</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">35+</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">266.0000</td>
<td style="text-align: right;">64</td>
<td style="text-align: left;">Non-Hispanic Black</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">25 to &lt;30</td>
<td style="text-align: left;">Never</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">125.3333</td>
<td style="text-align: right;">79</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">102.0000</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">201.3333</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">25 to &lt;30</td>
<td style="text-align: left;">Former</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">270.0000</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">Non-Hispanic White</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">&lt;25</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">128.0000</td>
<td style="text-align: right;">78</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">188.0000</td>
<td style="text-align: right;">61</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Former</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">198.0000</td>
<td style="text-align: right;">69</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">&lt;25</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">173.8333</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
</tbody>
</table>
</div>
</div>
<<<<<<< HEAD
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>roc_mod <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">predictor=</span>pred_probs_simple, <span class="at">response=</span>clean_nhanes<span class="sc">$</span>cc_diabetes_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_mod, <span class="at">print.auc =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="residuals-histogram" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="residuals-histogram"><span class="header-section-number">5.6</span> Residuals Histogram</h2>
<p>A histogram of residuals should resemble a standard normal distribution, ideally. The histogram will plot the frequency of each pearson residual value. In an ideal model, the error between the predictions and observations (residuals) will be a result of random noise, creating a Gaussian shape. Skewness and irregularities may be a sign that the model is not fit properly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(full_diab_model_sys, <span class="at">type=</span><span class="st">"pearson"</span>), <span class="at">breaks =</span> <span class="dv">20</span>) <span class="co">#specify shape</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>lev <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(full_diab_model_sys)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>top_10 <span class="ot">&lt;-</span> <span class="fu">sort</span>(lev, <span class="at">decreasing=</span><span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>clean_nhanes[<span class="fu">as.numeric</span>(<span class="fu">names</span>(top_10))] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(used_vars)) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">cc_diabetes</th>
<th style="text-align: right;">bp_sys_mean</th>
<th style="text-align: right;">demo_age_years</th>
<th style="text-align: left;">demo_race</th>
<th style="text-align: left;">demo_gender</th>
<th style="text-align: left;">cc_bmi</th>
<th style="text-align: left;">cc_smoke</th>
<th style="text-align: left;">bp_med_use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">217.3333</td>
<td style="text-align: right;">51</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">35+</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">266.0000</td>
<td style="text-align: right;">64</td>
<td style="text-align: left;">Non-Hispanic Black</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">25 to &lt;30</td>
<td style="text-align: left;">Never</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">125.3333</td>
<td style="text-align: right;">79</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">102.0000</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">201.3333</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">25 to &lt;30</td>
<td style="text-align: left;">Former</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">270.0000</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">Non-Hispanic White</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">&lt;25</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">128.0000</td>
<td style="text-align: right;">78</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">188.0000</td>
<td style="text-align: right;">61</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Former</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">198.0000</td>
<td style="text-align: right;">69</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">&lt;25</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">173.8333</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(simple_diab_model_sys, <span class="at">type=</span><span class="st">"pearson"</span>), <span class="at">breaks =</span> <span class="dv">20</span>) <span class="co">#specify shape</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
=======
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(simple_diab_model_sys, <span class="at">type=</span><span class="st">"pearson"</span>), <span class="at">breaks =</span> <span class="dv">20</span>) <span class="co">#specify shape</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lev <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(full_diab_model_sys)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>top_10 <span class="ot">&lt;-</span> <span class="fu">sort</span>(lev, <span class="at">decreasing=</span><span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>clean_nhanes[<span class="fu">as.numeric</span>(<span class="fu">names</span>(top_10))] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(used_vars)) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">cc_diabetes</th>
<th style="text-align: right;">bp_sys_mean</th>
<th style="text-align: right;">demo_age_years</th>
<th style="text-align: left;">demo_race</th>
<th style="text-align: left;">demo_gender</th>
<th style="text-align: left;">cc_bmi</th>
<th style="text-align: left;">cc_smoke</th>
<th style="text-align: left;">bp_med_use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">217.3333</td>
<td style="text-align: right;">51</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">35+</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">266.0000</td>
<td style="text-align: right;">64</td>
<td style="text-align: left;">Non-Hispanic Black</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">25 to &lt;30</td>
<td style="text-align: left;">Never</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">125.3333</td>
<td style="text-align: right;">79</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">102.0000</td>
<td style="text-align: right;">73</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">201.3333</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">25 to &lt;30</td>
<td style="text-align: left;">Former</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">270.0000</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">Non-Hispanic White</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">&lt;25</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">128.0000</td>
<td style="text-align: right;">78</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">188.0000</td>
<td style="text-align: right;">61</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Former</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">198.0000</td>
<td style="text-align: right;">69</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Men</td>
<td style="text-align: left;">&lt;25</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">173.8333</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">Women</td>
<td style="text-align: left;">30 to &lt;35</td>
<td style="text-align: left;">Current</td>
<td style="text-align: left;">Yes</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="ignore" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="ignore"><span class="header-section-number">5.7</span> Ignore///</h2>
<p>I followed a guide online but I don’t really know what this is doing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>clean_nhanes <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_res =</span> <span class="fu">coef</span>(full_diab_model_sys)[<span class="st">"demo_age_years"</span>]<span class="sc">*</span>demo_age_years <span class="sc">+</span> <span class="fu">residuals</span>(full_diab_model_sys, <span class="at">type =</span> <span class="st">"working"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> demo_age_years, <span class="at">y =</span> comp_res)) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<<<<<<< HEAD
<div>
<figure class="figure">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
=======
<p><img src="diagnostics_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>clean_nhanes <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_res =</span> <span class="fu">coef</span>(full_diab_model_sys)[<span class="st">"bp_sys_mean"</span>]<span class="sc">*</span>bp_sys_mean <span class="sc">+</span> <span class="fu">residuals</span>(full_diab_model_sys, <span class="at">type =</span> <span class="st">"working"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bp_sys_mean, <span class="at">y =</span> comp_res)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<<<<<<< HEAD
<div>
<figure class="figure">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
=======
<p><img src="diagnostics_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
</div>
</div>
<p>Test for Multicollinearity</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(full_diab_model_sys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   GVIF Df GVIF^(1/(2*Df))
bp_sys_mean    1.169212  1        1.081301
demo_age_years 1.528167  1        1.236191
demo_race      1.207663  4        1.023866
demo_gender    1.091056  1        1.044536
cc_bmi         1.182024  3        1.028263
cc_smoke       1.173951  2        1.040908
bp_med_use     1.235766  1        1.111650</code></pre>
</div>
</div>
<p>Outliers</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>outlier_nhanes <span class="ot">&lt;-</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  clean_nhanes <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dffits =</span> <span class="fu">dffits</span>(full_diab_model_sys))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>outlier_nhanes <span class="sc">%&gt;%</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">obs_number =</span> <span class="fu">row_number</span>(),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">large =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(dffits) <span class="sc">&gt;</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">length</span>(<span class="fu">coef</span>(full_diab_model_sys))<span class="sc">/</span><span class="fu">nobs</span>(full_diab_model_sys)),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"red"</span>, <span class="st">"black"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(obs_number, dffits, <span class="at">color =</span> large)) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">length</span>(<span class="fu">coef</span>(full_diab_model_sys))<span class="sc">/</span><span class="fu">nobs</span>(full_diab_model_sys)), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<<<<<<< HEAD
<div>
<figure class="figure">
<p><img src="diagnostics_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
=======
<p><img src="diagnostics_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
<<<<<<< HEAD
      <a href="./initial_modeling.html" class="pagination-link" aria-label="Modeling Diabetes Occurrence">
=======
      <a href="./initial_modeling.html" class="pagination-link">
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modeling Diabetes Occurrence</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
<<<<<<< HEAD
      <a href="./add_noise.html" class="pagination-link" aria-label="Creating &quot;Noisy&quot; Data">
=======
      <a href="./add_noise.html" class="pagination-link">
>>>>>>> c9a5398948af0ee96a901162a4aa770118e51b7f
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Creating “Noisy” Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>